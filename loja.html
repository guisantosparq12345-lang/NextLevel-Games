<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Loja de Jogos</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<header>
    <input type="text" id="search" placeholder="Buscar jogo...">
    <button onclick="logout()">Logout</button>
</header>

<div id="catalogo"></div>

<div class="carrinho">
    <h3>Carrinho</h3>
    <ul id="listaCarrinho"></ul>
    <strong>Total: R$ <span id="total">0.00</span></strong>
    <button onclick="finalizarCompra()">Finalizar Compra</button>
</div>

<script>
const currentUser = JSON.parse(localStorage.getItem("currentUser"));
if(!currentUser) {
    alert("üîí Fa√ßa login!");
    window.location.href = "index.html";
}

// Jogos
let jogos = JSON.parse(localStorage.getItem("games")) || [
    { nome:"The Witcher 3", genero:"RPG", preco:59.90, imagem:"https://upload.wikimedia.org/wikipedia/en/0/0c/Witcher_3_cover_art.jpg" },
    { nome:"GTA V", genero:"A√ß√£o", preco:79.90, imagem:"https://upload.wikimedia.org/wikipedia/en/a/a5/Grand_Theft_Auto_V.png" },
    { nome:"Minecraft", genero:"Sandbox", preco:49.90, imagem:"https://upload.wikimedia.org/wikipedia/en/5/51/Minecraft_cover.png" }
];

let carrinho = currentUser.cart || [];

const catalogo = document.getElementById("catalogo");
const search = document.getElementById("search");
const listaCarrinho = document.getElementById("listaCarrinho");
const totalSpan = document.getElementById("total");

function logout() {
    localStorage.removeItem("currentUser");
    window.location.href = "index.html";
}

function mostrarJogos(lista){
    catalogo.innerHTML = "";
    lista.forEach(jogo => {
        const card = document.createElement("div");
        card.className = "card";
        card.innerHTML = `
            <img src="${jogo.imagem}">
            <div class="info">
                <h3>${jogo.nome}</h3>
                <span>${jogo.genero}</span><br>
                <strong>R$ ${jogo.preco.toFixed(2)}</strong><br><br>
                <button onclick='adicionarCarrinho(${JSON.stringify(jogo)})'>Comprar</button>
            </div>
        `;
        catalogo.appendChild(card);
    });
}

search.addEventListener("input", ()=>{
    const texto = search.value.toLowerCase();
    mostrarJogos(jogos.filter(j => j.nome.toLowerCase().includes(texto)));
});

function adicionarCarrinho(jogo){
    carrinho.push(jogo);
    atualizarCarrinho();
}

function removerCarrinho(idx){
    carrinho.splice(idx,1);
    atualizarCarrinho();
}

function atualizarCarrinho(){
    listaCarrinho.innerHTML = "";
    let total = 0;
    carrinho.forEach((item,i)=>{
        total += item.preco;
        listaCarrinho.innerHTML += `<li>${item.nome} - R$ ${item.preco.toFixed(2)} <button onclick="removerCarrinho(${i})">‚ùå</button></li>`;
    });
    totalSpan.textContent = total.toFixed(2);

    // salvar no usu√°rio
    currentUser.cart = carrinho;
    let users = JSON.parse(localStorage.getItem("users"));
    const idx = users.findIndex(u => u.username === currentUser.username);
    users[idx] = currentUser;
    localStorage.setItem("users", JSON.stringify(users));
}

function finalizarCompra(){
    if(carrinho.length === 0) return alert("Carrinho vazio!");
    alert("‚úÖ Compra realizada!");
    carrinho = [];
    atualizarCarrinho();
}

mostrarJogos(jogos);
atualizarCarrinho();
</script>
</body>
</html>
